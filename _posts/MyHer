---
layout: post
title:  "Bayesian vs Frequentist Analyses of MyHeritage Results (and why it doesn't work)"
date: '2019-05-17 21:11:00'
---

### Introduction.
Few months ago my wife told me that she wanted to do one of those fancy genetic tests that look for your ancestors, so you can know where they were from or even find distant cousins around the world. Despite I advised her against it because of things like this: *[DNA testing signs a $300 million deal with a drug giant](https://nordic.businessinsider.com/dna-testing-delete-your-data-23andme-ancestry-2018-7?r=US&IR=T)*. She insisted and I bought her a kit from MyHeritage.
Few weeks ago she received the results and she imediatly felt dissappointed: just few percentages relating her genes with some populations around the globe, that was all!!!. 
Firstly, I was really curious about how those percentages were calculated and what they really mean so I started analyzing the raw data that MyHeritage provided a .csv file with the sequence of more than 600000 single nucleotide polymorphisms (SNPs). 600K SNPs to provide only few percentages?? Are we crazy?! There is obviosly much more that you can extract from that huge amount of information about your self and in this post I will give you some examples and guidelines for you to sequezee the maximum out of it. I will show you not only to find the closer populations according to your genes but to find if you have some predisposition to suffer from some disseases.  
{: style="text-align: justify"}
<!--more-->

### Genetical background.
Let's start from the beggining: *What the hell is a SNP? and why you should care about them.*
We could say that the genome is the blueprint of life and the genes the instructions to build every single living organism, that means that different organisms must have different blueprints, right? But the question is how different they are? You have probably heard many times things like "humans share 85% of their DNA sequence with mice", so if our blueprints and mice's ones are 85% similar, how different are the DNA sequence between two humans? If we look at human beings the differences between us are very subtle. Most of the genes are exactly the same among the all human populations (and some Neanderthal), and the ones that are different, differ only in a tiny proportion. And here is where SNPs come in, one SNP is mininal possible difference between two genes in two individuals, so the sum of all the SNPs in our genomes is what makes us unique for bad or for good. Unfortunately, the vast majority of human SNPs are unkown, however everyday science describe more and more SNPs, relating them with diseases or phenotipic traits so probably in few years we will have the description of all the effects for every single SNP in the genome.

If you want a more technical definition, we could say that a SNP is one position in one nucleotide of the 6.4·10^9 nucleotides that we have in our genomes and that that nucleotide has one "reference" value (A,T,G or C) and one or more variant values which can be linked or not with certain phenotypes. To make things even more complex we need to consider that we humans are diploids, that means that we carry two copies of every SNP in the genome: one from your father and one from your mother so it is possible to have three combinations for each SNP:
Reference-Reference
Reference-Variant or Variant-Reference
Variant-Variant

And each combination can have different traits, increasing the complexity of the story even more. 

**Note: If you are a male all the SNPs in your X chromosome come from you mother and all the SNPs in the Y chromosome from your father.**

![SNP](/images/Dna-SNP.svg.png)

### How does the test work, then?.

Now we know what SNPs are, but how can they help us to find our ancestors?. To asnwer this question we need to talk about another characteristic of the DNA, the DNA is very very stable so it is very rare for mutations to happen and SNPs are just mutations over the "reference" genome that happened several thousands of years ago. As the human populations in the world were small and disperse at that time it is possible to associated certain SNPs with certain ancient populations which can be aggregated in five branches: African, European, American, South-Asian and East-Asian. For each SNPs the percentage of individuals in each population varies. For instance, the reference nucleotide for the SNP rs10000008 located in the chromosome 4 position 172776204 is a C and the variant is a T, the frequency of the variant among the African population is 28.52% while the frequency among the European population is just 1.59%, that means that if you have a T it is more likely that you are African than European.  

### Statistical background.

Now that we know how the SNPs can help us to track our origines back we need some statistical background to analyze the data and draw some conclusions. 

There are several statistical approaches to analyze SNPs

The frequentist way and the bayesian way. In the frequentist way it would be possible to find SNPs highly enriched in each population and determine how many of those are in the sample. However, finding typical SNPs for all populations is not easy and it requires some assumptions like how much frequent a SNP has to be in a population compared with the rest of the populations to be considered typical in a particular population? Additionally, some SNPs might be more frequent in a population than in the rest by a large proportion but still very unlikely to happen (e.g. the SNP rs117425567 has a frequency among the African population of 0.0008% and among the europeans of 0.0014, it is much more abundant among the africans but the percentages are so low that it is very unlikely that we find it in our sample either) 

To solve these issues 



The bayesian analyses rely on the Bayes' theorem: 

 $$P(A|B) = {P(B|A)· P(A) \over P(B)}$$
 
 Where 
 
 P(A|B) is the conditional probability of A occurring given the fact B 
 i.e: The probability of being European if you have certain SNP
 
 P(B|A) is the conditional probability of B occurring given the fact A
 i.e. The probability of having certain SNP among the european population
 
 p(B) is the probability of B occurring
 i.e. The probability of being European
 
 p(A) is the probability of A occurring
 i.e The probability of havin certain SNP
 
But in this case we don't have only one SNP, we have more than 600000 so it is possible to combine them to have a stronger prediction, lets see how the Bayes' theorem works for multiple events (i.e. SNPs)

 $$P(A|B \bigcap C) = {P(B \bigcap C|A)· P(A) \over P(B \bigcap C)}$$

However there are a couple of problems, we dont know the firs element of the numerator and the denominator so we need to precalculate them. When two events are not ligated: 

 $$P {P(B \bigcap C|A) =  P(B|A)·P(C|A)}$$

and both P(B|A) and P(C|A) are known. Regarding the ligation of SNPs, we have to consider that the SNPs very close in the genome are ligated, meaning that they are if you inherit one is very likely that you inherit others from your the same progrenitor, howevere we have a lot of SNPs, many more than we need so this is not going to be a problem. 

Calculating the denominator is a bit more complicated, however we know that:

 $$P(A|B \bigcap C) = {P(B \bigcap C|A)· P(A) \over P(B \bigcap C)}$$
 
 $$P(\sim A|B \bigcap C) = {P(B \bigcap C| \sim A)· P(\sim A) \over P(B \bigcap C)}$$
 
Where $$P(\sim A|B \bigcap C)$$ is the probability of not occurring A when B and C are occurring since both probabilities are complementary:  

$$P(A|B \bigcap C) + P(\sim A|B \bigcap C) = 1}$$

We can calculate the denominator:


The whole equation looks like this

and this is the general formula:


Source





### Analysis of populations.

## Rename of data to merge

nacho@Skadi:~/MyHerr/SNPS/snps2$ rename 's/_17289/-set_6/' *

merger
for file in  ???-*. C
  cat "$file" . C
  cat >>"${file%_*}.txt" . C
  cat
done


### Analysis of diseases. 

### Paternity test.

### Conclusions.

### Sources of inspiration
